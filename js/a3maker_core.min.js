A3Maker=A3Maker||{};var A3Maker={holder:"#page-container",page:".page",editorPane:".content_container",project:null,scrollBarWidth:0,mode:"test",abmsProjectNo:"",lang:"",member_seq:"",message:function(e){alert(e)},log:function(e){console.log(e)},init:function(){var e=this.getUrlParams();if(e&&(abmsProjectNo=e.abmsProjectNo,lang=e.lang,abmsProjectNo&&""!=abmsProjectNo&&(mode="product")),"test"==this.mode)$("#project_config").draggable({containment:"document"}),$("#project_setting_ok").click(function(e){var t=document.querySelector("#project_import");if(null!=t.files[0]&&""!=t.files[0]&&void 0!==t.files[0]){var r=t.files[0],o=new FileReader;o.onloadend=function(e){if(e.target.readyState==FileReader.DONE){var t=JSON.parse(e.target.result),r={data:JSON.stringify(t)};try{A3Maker.createProjectFromJson(r),A3Maker.canvas.init(),A3Maker.multiSelectionRect.init(),A3Maker.validation.init(),A3Maker.scrollBarWidth=A3Maker.util.getScrollbarWidth(),A3Maker.sidebar.init(),A3Maker.statusBar.init(),A3Maker.projectSetting.close()}catch(e){console.error("import file error",e)}}},o.readAsText(r,"utf-8")}else{var a=$("#project_settings_name").val(),n=$("#project_settings_width").val(),i=$("#project_settings_height").val();if(""==a.trim()||isNaN(n)||isNaN(n)||s<100||c<100)return void alert("입력내용이 잘못되었습니다. 다시 확인해주세요");var c=parseInt(n),s=parseInt(i),l={projectSeq:1,projectName:a,projectDesc:"A3Maker 로컬 모드",width:c,height:s,createTime:(new Date).toString()};A3Maker.createProject(l),A3Maker.controller.init(),A3Maker.canvas.init(),A3Maker.multiSelectionRect.init(),A3Maker.validation.init(),A3Maker.scrollBarWidth=A3Maker.util.getScrollbarWidth(),A3Maker.sidebar.init(),A3Maker.statusBar.init(),A3Maker.projectSetting.close()}}),A3Maker.projectSetting.open();else{if("product"!=this.mode)return alert("wrong access !"),void console.log(response.messageText);A3Maker.api.A3MakerApi("loadProjectInfo",{abmsProjectNo:abmsProjectNo},function(e){100==e.resultCode?(A3Maker.canvas.init(),A3Maker.multiSelectionRect.init(),A3Maker.validation.init(),A3Maker.scrollBarWidth=A3Maker.util.getScrollbarWidth(),A3Maker.sidebar.init(),A3Maker.statusBar.init(),A3Maker.projectSetting.close()):(alert("wrong access !"),console.log(e.messageText))})}},createProject:function(e){return this.project=new A3Maker.Project(e),this.project},saveProject:function(){var e=this.createJsonFromProject();A3Maker.api.A3MakerApi("saveProject",{abmsProjectNo:A3Maker.project.projectSeq,data:JSON.stringify(e)},function(e){setTimeout(function(){alert(e.messageText)},30)})},createProjectFromJson:function(e){var t=JSON.parse(e.data);this.header=t.header;var r=t.project,o="",a={projectSeq:r.projectSeq?r.projectSeq:-1,projectName:r.projectName?r.projectName:"any",projectDesc:r.projectDesc?r.projectDesc:"any",width:r.width?r.width:1e3,height:r.height?r.height:1200,createTime:t.project.createTime?t.project.createTime:new Date},n=this.getProject();if(n){var i=n.pages;if(i.length>0)for(var c=0;c<i.length;c++)this.project.removePage(i[c])}if(this.project=null,this.project=new A3Maker.Project(a),A3Maker.controller.init(),r.pages.length>0)for(c=0;c<r.pages.length;c++)page=this.createPageFromJson(this.project,r.pages[c]),0==c&&(o=page);return o&&A3Maker.controller.selectPage(o),this.project},createPageFromJson:function(e,t){var r=this.project.createPageInsert(null,null,t.data);if(t.childs.length>0)for(var o=0;o<t.childs.length;o++)this.createComponentFromJson(r,t.childs[o]);return r},createComponentFromJson:function(e,t){var r=e.createComponent(t.data.type,!0,!0,t.data);if(r.attach(),void 0!==t.childs&&t.childs.length>0)for(var o=0;o<t.childs.length;o++)this.createComponentFromJson(r,t.childs[o])},createJsonFromProject:function(){var e={};if(e.header=this.header,e.project={projectSeq:this.project.projectSeq,projectName:this.project.projectName,projectDesc:this.project.projectDesc,width:this.project.width,height:this.project.height,createTime:this.project.createTime,pages:[]},this.project.pages.length>0)for(var t=0;t<this.project.pages.length;t++)this.createJsonFromPage(e.project,this.project.pages[t]);return e},createJsonFromPage:function(e,t){var r={typeCode:t.data.type,data:t.data,childs:[]};if(t.childs.length>0)for(var o=0;o<t.childs.length;o++)this.createJsonFromComponent(r,t.childs[o]);e.pages.push(r)},createJsonFromComponent:function(e,t){var r;switch(t.data.type){case"list":case"listrow":case"popup":if(r=this.generateComponentJson(t),e.childs.push(r),void 0!==t.childs&&t.childs.length>0)for(var o=0;o<t.childs.length;o++)this.createJsonFromComponent(r,t.childs[o]);break;case"image":case"text":case"link":case"order":r=this.generateComponentJson(t),e.childs.push(r)}},generateComponentJson:function(e){var t={data:e.data,typeCode:e.data.type};switch(e.data.type){case"popup":case"list":case"listrow":t.childs=[]}return t},importProjectFromJson:function(e){},addPageTmeplateToProject:function(e){if(this.project){var t=e.searchResult;console.log(JSON.parse(e.searchResult.menu_json));var r=this.convertScreenData(JSON.parse(t.menu_json));this.loadingProjectSize={width:t.width_size,height:t.height_size},this.isPageLoading=!0,this.createPageFromJson(r,"add"),this.loadingProjectSize=null,this.isPageLoading=!1}else alert("wrong reqeust : 프로젝트가 존재하지 않습니다")},getUrlParams:function(){var e={};return window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,r,o){e[r]=o}),e},showPage:function(e){this.project.showPage(e)},showPageFromChild:function(e){if("root"!=e.data.type)if("page"!=e.data.type){var t=[];this.findParentsRecursive(t,e),this.showPage(t[0])}else{this.showPage(e);var r=A3Maker.controller.$tree.tree("getNodeById",e.UUID);A3Maker.controller.$tree.tree("selectNode",r)}else console.log(e.data.type+" : 해당 컴포넌트의 루트 page 객체를 구할 수 없거나 해당 객체가 page 입니다.")},hidePage:function(e,t){this.project.hidePage(e,t)},hidePageFromChild:function(e){if("root"!=e.data.type&&"page"!=e.data.type){var t=[];this.findParentsRecursive(t,e),this.showPage(t[0])}else console.log(e.data.type+" : 해당 컴포넌트의 루트 page 객체를 구할 수 없거나 해당 객체가 page 입니다.")},findParentsRecursive:function(e,t){var r=t.parent;if(e.unshift(t.parent),"page"==t.parent.type)return e;this.findParentsRecursive(e,r)},clonePage:function(e){var t=this,r=A3Maker.createPage();return $.each(e.childs,function(e,o){t.cloneComponent(r,o)}),r},attachAllComponentRecursive:function(e){var t=this;e.parent.addComponent(e),e.parent.addComponentToTree(e),e.attach(),$.each(e.childs,function(e,r){t.attachAllComponentRecursive(r)})},cloneComponent:function(e,t,r,o){var a=this,n=e.createComponent(t.type,r,o);switch(n.x=t.x,n.y=t.y,n.width=t.width,n.height=t.height,n.fixRatio=t.fixRatio,t.type){case"image":n.src=t.src;break;case"text":n.text=t.text,n.fontFamily=t.fontFamily,n.fontSize=t.fontSize,n.color=t.color;break;case"link":n.src=t.src,n.linkType=t.linkType,n.position=t.position;break;case"order":n.src=t.src,n.menu=t.menu,n.price=t.price}return 1==o&&n.attach(),$.each(t.childs,function(e,t){a.cloneComponent(n,t,r,o)}),n},attchComponentForContextAction:function(e){var t=this;e.parent.addComponentToTree(e),e.attach(),$.each(e.childs,function(e,r){t.attchComponentForContextAction(r)})},cloneComponentForContextAction:function(e,t){var r=this;switch(e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e.fixRatio=t.fixRatio,t.type){case"image":e.src=t.src;break;case"text":e.text=t.text,e.fontFamily=t.fontFamily,e.fontSize=t.fontSize,e.color=t.color;break;case"link":e.src=t.src,e.linkType=t.linkType,e.position=t.position;break;case"order":e.src=t.src,e.menu=t.menu,e.price=t.price}return t.childs&&t.childs.length>0&&$.each(t.childs,function(t,o){var a=e.createComponent(o.type,!0,!1);r.cloneComponentForContextAction(a,o)}),e},initialzeTooluttonEventHandler:function(){A3Maker.controller.init()},createPage:function(){this.project||concole.log("No project");var e=this.project.createPage();return e},isRegiteredPage:function(e){for(var t in this.pages)if(pageObj.get("pageNo")==e)return!0;return!1},changeAllComponentSelectStatus:function(e,t){this.project.changeAllComponentSelectStatus(e,t)},changeStatusAllComponentOfPage:function(e,t){this.project.changeAllComponentOfPage(e,t)},removePage:function(e){this.project.removePage(e)},findPage:function(e){var t;for(var r in this.pages)r.get("pageNo")&&(t=r);return t},getProject:function(){return this.project},setSelectedPage:function(e){e?this.project.setSelectedPage(e):this.project.setSelectedPage(this.project.pages[0])},setSelectedComponent:function(e){e||(this.project.setSelectedPage(this.getSelectedPage()),A3Maker.propertyWindow.closePropertyWindow()),this.project.setSelectedComponent(e)},getSelectedPage:function(){return this.project.getSelectedPage()},getSelectedComponent:function(){return this.project.getSelectedComponent()},getPropery:function(e){return!!this.hasOwnProperty(e)&&this[e]},setProperty:function(e,t){this[e]=t},extractVar:function(e){$.each(e,function(e,t){this.setProperty(e,t)})}};