A3Maker=A3Maker||{},A3Maker.Project=function(e){var t={projectSeq:1,projectName:"A3 Maker Test Project",projectDesc:"A3Maker 테스드",width:700,height:800,createTime:(new Date).toString()};this.componentMap={},e&&$.extend(t,e),this.data=t,this.extract(t),this.pages=new Array,this.selectedPage=null,this.selectedComponent=null,this.init()},A3Maker.Project.prototype.init=function(){$(".ajax_top_loading").hide(),A3Maker.config.autoSave&&this.startAutoSave(),A3Maker.config.autoValidate&&this.startAutoValidate(),A3Maker.config.autoSustainSession&&this.startSustainSession(),this.adjustCanvas()},A3Maker.Project.prototype.IsTemplateProject=function(){return 0!=this.projectInfo.category_code_seq},A3Maker.Project.isSuperUser=function(){return!!(this.memberInfo.member_gubun=0)},A3Maker.Project.prototype.startSustainSession=function(){A3Maker.config.autoSustainSession?this.sustainSessionIntervalId=setInterval(function(){A3Maker.api.A3MakerApi("sustainSession",null,function(e){-1==e.resultCode&&alert("Session Error. Redirct to the login page ")})},this.sustainSessionIntervale):$(".ajax_top_loading").hide()},A3Maker.Project.prototype.stopSustainSession=function(){clearInterval(this.sustainSessionIntervalId)},A3Maker.Project.prototype.startAutoSave=function(e){if(A3Maker.config.autoSave){var t=this;this.autoSavieId=setInterval(function(){t.saveProject()},this.autoSaveInterval)}},A3Maker.Project.prototype.saveProject=function(){},A3Maker.Project.prototype.convertProjectToJson=function(){},A3Maker.Project.prototype.convertPageToUploadFormat=function(e){1==e.PAGE.length&&(e.PAGE=e.PAGE[0])},A3Maker.Project.prototype.stopAutoSave=function(e){clearInterval(this.autoSavieId)},A3Maker.Project.prototype.startAutoValidate=function(e){A3Maker.config.autoValidate&&A3Maker.validation.startValidation(this.validationInterval)},A3Maker.Project.prototype.stopAutoValidate=function(e){A3Maker.validation.stopValidation()},A3Maker.Project.prototype.extract=function(e){var t=this;$.each(e,function(e,o){t.setProperty(e,o)})},A3Maker.Project.prototype.getProperty=function(e){return!!this.hasOwnProperty(e)&&this[e]},A3Maker.Project.prototype.setProperty=function(e,t){this[e]=t},A3Maker.Project.prototype.adjustCanvas=function(){$(A3Maker.holder).css("width",this.width+"px"),$(A3Maker.holder).css("height",this.height+"px"),A3Maker.controller.canvasWidth=this.width,A3Maker.controller.canvasHeight=this.height},A3Maker.Project.prototype.getPages=function(){return this.pages},A3Maker.Project.prototype.showPage=function(e){this.hideAllPage(),$.each(this.pages,function(t,o){o.data.UUID==e.data.UUID&&(o.$pageHolderSelector.show(),A3Maker.setSelectedComponent(null),A3Maker.setSelectedPage(o))}),A3Maker.propertyWindow.setPropertyWindowPos(2,90),A3Maker.propertyWindow.setInitInfo({name:A3Maker.getSelectedPage().data.name,x:this.left,y:this.right,width:0,height:0,fixRatio:!1}),A3Maker.propertyWindow.showPropertyWindow(A3Maker.getSelectedPage().data.type,100,100)},A3Maker.Project.prototype.hidePage=function(e,t){$.each(this.pages,function(t,o){o.data.UUID!=e||o.$pageHolderSelector.hide()})},A3Maker.Project.prototype.hideAllPage=function(){$.each(this.pages,function(e,t){t.$pageHolderSelector.hide()})},A3Maker.Project.prototype.removePage=function(e){var t=-1;if($.each(this.pages,function(o,r){r.data.UUID!=e.data.UUID||(t=o)}),-1!=t){console.log("## removePage"),console.log(t),e.clearAll(),this.pages.splice(t,1),e.destroy();var o=A3Maker.controller.$tree.tree("getNodeById",e.data.UUID);A3Maker.controller.$tree.tree("removeNode",o),A3Maker.controller.$tree.tree("selectNode",null)}},A3Maker.Project.prototype.get=function(e){return!!this.hasOwnProperty(e)&&this[e]},A3Maker.Project.prototype.set=function(e,t){this[e]=t},A3Maker.Project.prototype.createPage=function(e){var t=this.createPageNo(),o=A3Maker.util.genUUID(),r={type:"page",id:o,UUID:o,no:t,name:"page"+t,left:0,top:0,width:this.width,height:this.height,"background-color":"rgba(255,255,255,1)",desc:"","background-image":""};e&&$.extend(r,e);var a=new A3Maker.Page(r);this.pages.push(a),this.selectedPage=a,A3Maker.setSelectedComponent(null),A3Maker.setSelectedPage(a),A3Maker.propertyWindow.closePropertyWindow(),A3Maker.showPage(a);var n=A3Maker.controller.$tree.tree("getNodeById",A3Maker.project.projectName);return this.addPageToNode(a,n,"appendNode"),a},A3Maker.Project.prototype.createPageInsert=function(e,t,o){e=e||"first";var r=this.createPageNo(),a=A3Maker.util.genUUID(),n={type:"page",id:a,UUID:a,no:r,name:"page"+r,left:0,top:0,opacity:1,width:this.width,height:this.height,"background-color":"rgba(255,255,255,1)",desc:"","background-image":""};o&&$.extend(n,o);var i=new A3Maker.Page(n);switch(this.selectedPage=i,A3Maker.setSelectedComponent(null),A3Maker.setSelectedPage(i),A3Maker.propertyWindow.closePropertyWindow(),A3Maker.showPage(i),e){case"first":this.pages.push(i);var s=A3Maker.controller.$tree.tree("getNodeById",A3Maker.project.projectName);this.addPageToNode(i,s,"appendNode");break;case"after":for(var c=-1,p=0;p<this.pages.length;p++)if(t.data.UUID==this.pages[p].data.UUID){c=p;break}-1!=c&&this.pages.splice(c+1,0,i);var l=A3Maker.controller.$tree.tree("getNodeById",t.data.UUID);return this.addPageToNode(i,l,"addNodeAfter"),t.$pageHolderSelector.after(i.$pageHolderSelector),i}return i},A3Maker.Project.prototype.addPageToNode=function(e,t,o){A3Maker.controller.$tree.tree(o,{label:e.data.name,id:e.data.UUID,type:e.data.type,data:e},t);var r=A3Maker.controller.$tree.tree("getNodeById",e.data.UUID);A3Maker.controller.$tree.tree("selectNode",r)},A3Maker.Project.prototype.createPageNo=function(){var e=0;if(0==this.pages.length)e=1;else{var t=$.map(this.pages,function(e,t){return e.data.no});t.sort(function(e,t){return e<t?-1:e>t?1:0}),e=t[t.length-1]+1}return e},A3Maker.Project.prototype.setSelectedPage=function(e){this.selectedPage=e},A3Maker.Project.prototype.setSelectedComponent=function(e){this.setSelectedPage&&(this.selectedComponent=e,this.selectedPage.setSelectedComponent(e))},A3Maker.Project.prototype.changeAllComponentSelectStatus=function(e,t){var o=this;e?this.changeAllComponentSelectStatusRecursive(e,t):$.each(this.pages,function(e,r){o.changeAllComponentSelectStatusRecursive(r,t)})},A3Maker.Project.prototype.changeStatusAllComponentOfPage=function(e,t){context.changeAllComponentSelectStatusRecursive(e,t)},A3Maker.Project.prototype.changeAllComponentSelectStatusRecursive=function(e,t){var o=this;!e.hasOwnProperty("childs")||e.childs.length<1||$.each(e.childs,function(e,r){"popup"!=r.data.type&&"panseo"!=r.data.type||$(r.externalWrapperQueryStr).hide(),o.EnableComponentBorderAndGrip(r,t),o.changeAllComponentSelectStatusRecursive(r,t)})},A3Maker.Project.prototype.EnableComponentBorderAndGrip=function(e,t){"page"!=e.data.type&&(t?(e.showBorderTool(),e.showGripTool(),e.selectStatus=!0):(e.hideBorderTool(),e.hideGripTool(),e.selectStatus=!1))},A3Maker.Project.prototype.getSelectedPage=function(e){return this.selectedPage},A3Maker.Project.prototype.getSelectedComponent=function(e){return this.selectedComponent},A3Maker.Project.prototype.hasSameNamedPage=function(e){var t=this.pages.findIndex(t=>t.data.name.trim()==e),o=-1!=t;return o};