A3Maker=A3Maker||{},$(function(){A3Maker.contextMenu={requestActionEnums:{PAGE:1,COMPONENT:2,NONE:3},isShown:!1,selector:$(A3Maker.contextHTML),initControl:function(){this.selector.appendTo($("body")),this.selector.css("position","absolute"),this.selectorZIndex=this.selector.css("zIndex"),this.initializeEventHandlers(),this.selector.hide()},initializeEventHandlers:function(){var e=this;this.selector.click(function(){A3Maker.controller.closeInsertTableLayer(),A3Maker.controller.closeInsertShapeLayer()});e=this;this.selector.find(".action").bind("click",function(t){t.preventDefault(),t.stopPropagation();var r=$(this).data("action");e.handleEvent(r,this),e.close()}),this.addShortCutEventHandler()},addShortCutEventHandler:function(){var e=this;$(document).bind("keydown",function(t){var r="";if(t.ctrlKey&&"c"===String.fromCharCode(t.which).toLowerCase()&&(r="copy"),t.ctrlKey&&"x"===String.fromCharCode(t.which).toLowerCase()&&(r="cut"),t.ctrlKey&&"v"===String.fromCharCode(t.which).toLowerCase()&&(r="paste"),t.ctrlKey&&"d"===String.fromCharCode(t.which).toLowerCase()&&(r="delete"),t.ctrlKey&&"f"===String.fromCharCode(t.which).toLowerCase()&&(r="front"),t.ctrlKey&&"b"===String.fromCharCode(t.which).toLowerCase()&&(r="back"),t.ctrlKey&&"n"===String.fromCharCode(t.which).toLowerCase()&&(r="new page"),""!=r){var a=A3Maker.controller.$tree.tree("getSelectedNode");e.requestType="page"==a.data.type?e.requestActionEnums.PAGE:e.requestActionEnums.COMPONENT,e.handleEvent.call(e,r),e.close()}})},show:function(e,t,r){this.requestType=e,this.isShown&&this.close();var a=A3Maker.getSelectedPage(),o=A3Maker.getSelectedComponent(),n=A3Maker.controller.getMenuSet(o);A3Maker.controller.applyToolButtonChange(o),this.showComponentInContext(n);window.screenX;var i=window.screenY,s=$(window).width(),l=$(window).height();l=i+l;this.isShown=!0,this.selector.show(),t=t+this.selector.width()+15>=s?t-this.selector.width()-15:t+5,r=r+this.selector.height()+15>=l?r-this.selector.height()-15:r,this.selector.css("left",t),this.selector.css("top",r),this.selector.css("zIndex","99999");a=A3Maker.getSelectedPage();a.$pageHolderSelector.find(".cross_grid_line").is(":visible")?$(".toggle_grid_text").html("눈금 숨기기"):$(".toggle_grid_text").html("눈금 보이기")},showComponentInContext:function(e){$("li .rbtn").hide(),$.each(e,function(e,t){$("li button."+t+"_btn").show()})},close:function(){this.isShown&&($("li .rbtn").show(),$("li.buttonmenu").show(),this.selector.hide(),this.isShown=!1,this.selector.css("zIndex",this.selectorZIndex))},canContextAction:function(e){return!(A3Maker.multiSelectionRect.getMultiSelectedComponentCount()>1)||(alert("현재 다중 선택상의 "+e+" 액션은 지원하지 않습니다"),!1)},showGridLine:function(){var e=A3Maker.getSelectedPage();if(e.$pageHolderSelector.find(".cross_grid_line").is(":visible")){var t=A3Maker.statusBar.getGridMarkerSize(),r="cross_grid_line_"+t;e.$pageHolderSelector.find(".cross_grid_line").removeClass().addClass("cross_grid_line").addClass(r)}},toggleGridLine:function(e){var t=A3Maker.getSelectedPage(),r=A3Maker.statusBar.getGridMarkerSize(),a="cross_grid_line_"+r;t.$pageHolderSelector.find(".cross_grid_line").is(":visible")?(t.$pageHolderSelector.find(".cross_grid_line").removeClass().addClass("cross_grid_line").hide(),$(".toggle_grid_text").html("눈금 보이기")):(t.$pageHolderSelector.find(".cross_grid_line").show(),t.$pageHolderSelector.find(".cross_grid_line").addClass(a),$(".toggle_grid_text").html("눈금 숨기기"))},handleEvent:function(e,t){var r=null,a=A3Maker.getSelectedPage(),o=A3Maker.getSelectedComponent();switch(e){case"clear_all":return void a.clearAll();case"toggle_grid_line":return void this.toggleGridLine();case"copy":if(!this.canContextAction(e))return;return"panseo"==o.data.type?void alert("판서는 페이지별로 한개만 가능하며, 복사 할 수 없습니다"):void(null!=o&&A3Maker.clipBoard.set(o));case"cut":if(!this.canContextAction(e))return;return"popup"==o.data.type&&A3Maker.controller.enableBeforeGrayPanel(!1,null),void(null!=o&&(a.removeComponent(o),A3Maker.setSelectedComponent(null),A3Maker.clipBoard.set(o),0==a.childs.length&&A3Maker.controller.applyToolButtonChange(A3Maker.getSelectedPage()),A3Maker.controller.enableBeforeGrayPanel(!1,null)));case"paste":if(!this.canContextAction(e))return;var n=A3Maker.clipBoard.get();if(!n)return void alert("현재 복사된 컴포넌트가 없습니다.");var i=null;o=A3Maker.getSelectedComponent();if(o?"listrow"==n.data.type?"list"!=o.data.type?(alert("LIISTROW 은 LIST 컴포넌트에만 추가 할 수 있습니다"),i=null):i=o:i="listrow"==o.data.type||"popup"==o.data.type?o:o.parent:"listrow"==n.type?(alert("LIISTROW 은 LIST 컴포넌트에만 추가 할 수 있습니다"),i=null):i=A3Maker.getSelectedPage(),i){n.data.top=n.data.top+25,n.data.left=n.data.left+25,n.data.idCreate=!0;var s=i.createComponent(n.data.type,!0,!0,n.data);s.attach(),s.setSelectStatus(!0),s.selectStatus=!0,A3Maker.setSelectedComponent(s),"listrow"==o.data.type&&s.setPositionAndWidth(10,10,s.width,s.height)}return void A3Maker.clipBoard.reset();case"delete":if(!this.canContextAction(e))return;if(this.requestType==this.requestActionEnums.PAGE){if(1==confirm("페이지내의 모든 컴포넌트도 삭제가 됩니다. 진행하시겠습니까")){for(var l=0,c=0;c<A3Maker.project.pages.length;c++)if(a.UUID===A3Maker.project.pages[c].UUID){l=c;break}A3Maker.statusBar.setPageSlider({value:l}),A3Maker.removePage(a),A3Maker.setSelectedComponent(null),A3Maker.setSelectedPage(null),A3Maker.sidebar.sidebarType===A3Maker.sidebar.sidebarTypeEnums.THUMBNAIL_VIEW&&A3Maker.sidebar.updateSideThumbnailView()}}else this.requestType==this.requestActionEnums.COMPONENT&&o&&("popup"==o.data.type&&A3Maker.controller.enableBeforeGrayPanel(!1,null),o.parent.removeComponent(o),0==a.childs.length&&A3Maker.controller.applyToolButtonChange(A3Maker.getSelectedPage()),A3Maker.setSelectedComponent(null));return;case"front":case"back":return;case"new_page":var d;a=A3Maker.getSelectedPage();d=a?A3Maker.project.createPageInsert("after",a):A3Maker.project.createPage(),A3Maker.changeAllComponentSelectStatus(!1),A3Maker.showPage(d);var p=A3Maker.controller.$tree.tree("getNodeById",d.data.UUID);A3Maker.controller.$tree.tree("selectNode",p),A3Maker.controller.applyToolButtonChange(d);for(l=0,c=0;c<A3Maker.project.pages.length;c++)if(d.data.UUID===A3Maker.project.pages[c].data.UUID){l=c;break}A3Maker.statusBar.setPageSlider({value:l+1}),A3Maker.statusBar.setPageNumberText(l+1,A3Maker.project.pages.length,d.data.name),A3Maker.sidebar.sidebarType===A3Maker.sidebar.sidebarTypeEnums.THUMBNAIL_VIEW&&A3Maker.sidebar.selectBar(A3Maker.sidebar.sidebarTypeEnums.THUMBNAIL_VIEW);break;case"in_img":r="image";break;case"in_txt":r="text";break;case"in_box":r="box";break;case"in_table":r="table";break;case"in_link":r="link";break;case"in_order":r="order";break;case"in_popup":r="popup";break;case"in_list":r="list";break;case"in_listrow":r="listrow";break;case"in_script":r="script";break;case"in_panseo":r="panseo";break;case"in_camera":r="camera"}if(r){if("box"==r)return A3Maker.controller.closeInsertTableLayer(),A3Maker.controller.closeInsertShapeLayer(),void A3Maker.controller.openInsertShapeLayer(t);if("table"==r)return A3Maker.controller.closeInsertTableLayer(),A3Maker.controller.closeInsertShapeLayer(),void A3Maker.controller.openInsertTableLayer(t);this.close();a=A3Maker.getSelectedPage(),o=A3Maker.getSelectedComponent();var h="";"script"==r?(newComponent=a.createComponent(r,!0,!0),newComponent.attach(),newComponent.setSelectStatus(!0),menusetComponent=newComponent):o?"listrow"==o.parent.type||"list"==o.parent.type||"popup"==o.parent.type?(h=o.parent.createComponent(r,!0),h.attach(),h.setSelectStatus(!0),h.selectStatus=!0,A3Maker.setSelectedComponent(h)):"listrow"==o.data.type||"list"==o.data.type||"popup"==o.data.type?(h=o.createComponent(r,!0),h.parent=o,h.attach(),h.setSelectStatus(!0),h.selectStatus=!0,A3Maker.setSelectedComponent(h)):(h=a.createComponent(r,!0),h.attach(),h.setSelectStatus(!0),h.selectStatus=!0,A3Maker.setSelectedComponent(h)):(h=a.createComponent(r,!0),h.attach(),h.setSelectStatus(!0),h.selectStatus=!0,A3Maker.setSelectedComponent(h)),A3Maker.controller.applyToolButtonChange(h),event.stopPropagation()}},removeShortCutEventHandler:function(){$(".shortcut").off("keydown",function(e){})},copyPopupChilds:function(e,t){$.each(t.childs,function(t,r){var a=e.createComponent(r.type);switch(a.x=r.x,a.y=r.y,a.width=r.width,a.height=r.height,a.fixRatio=r.fixRatio,a.data.type){case"image":a.src=r.src;break;case"text":a.text=r.text,a.fontFamily=r.fontFamily,a.fontSize=r.fontSize,a.color=r.color;break;case"link":a.src=r.src,a.linkType=r.linkType,a.position=r.position;break;case"order":a.src=r.src,a.menu=r.menu,a.price=r.price,a.menuId=r.menuId,a.unit=r.unit,a.stock=r.stock}})},copyListChilds:function(e,t){$.each(t.childs,function(t,r){var a=e.createComponent(r.type);a.x=r.x,a.y=r.y,a.width=r.width,a.height=r.height,a.fixRatio=r.fixRatio,$.each(r.childs,function(e,t){a.createComponent(t.type);switch(a.data.type){case"image":a.src=t.src;break;case"text":a.text=t.text,a.fontFamily=t.fontFamily,a.fontSize=t.fontSize,a.color=t.color;break;case"link":a.src=t.src,a.linkType=t.linkType,a.position=t.position;break;case"order":a.src=t.src,a.menu=t.menu,a.price=t.price,a.menuId=t.menuId,a.unit=t.unit,a.stock=t.stock}})})},clone:function(e,t){switch(e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e.fixRatio=t.fixRatio,t.type){case"image":e.src=t.src;break;case"text":e.text=t.text,e.fontFamily=t.fontFamily,e.fontSize=t.fontSize,e.color=t.color;break;case"link":e.src=t.src,e.linkType=t.linkType,e.position=t.position;break;case"order":e.src=t.src,e.menu=t.menu,e.price=t.price,e.menuId=t.menuId,e.stock=t.stock,e.unit=t.unit;break;case"popup":t.childs.length>0&&this.copyPopupChilds(e,t),e.permitComponents=t.permitComponents.slice(0);break;case"list":t.childs.length>0&&this.copyListChilds(e,t);break;case"listrow":e.childs=t.childs.slice(0),e.permitComponents=t.permitComponents.slice(0)}}},A3Maker.contextMenu.initControl()});