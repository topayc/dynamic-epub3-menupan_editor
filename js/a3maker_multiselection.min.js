A3Maker=A3Maker||{},$(function(){A3Maker.multiSelectionRect={mouseX:0,mouseY:0,$multiSelectRect:"",selectionActionEnum:{none:0,drag:1,dragSelect:2,ctrlSelect:3},selectionDirectionEnum:{topLeft:-1,bottomRight:1,topRight:2,bottomLeft:-2},curSelectionAction:"",$alignActionDialog:"",$$multiSelectRect:"",selectionComponentArr:[],selectionDirection:0,selectionContainer:"",isComponentSelected:function(){return this.selectionComponentArr.length>0},init:function(){this.curSelectionAction=this.selectionActionEnum.none,this.initializeSelectionRectEventHandler(),this.initializeAlignDialogEventHandler()},initializeSelectionRectEventHandler:function(t){var e=t||"body",n=this;$(A3Maker.multiSelectStr).appendTo(e),this.$multiSelectRect=$(".multi_select").width(0).height(0).hide(),$(document).on("mousedown","#vertical_table",function(t){t.ctrlKey&&n.curSelectionAction==n.selectionActionEnum.none&&(n.curSelectionAction=n.selectionActionEnum.drag,n.mouseX=t.pageX,n.mouseY=t.pageY,n.$multiSelectRect.css("left",n.mouseX),n.$multiSelectRect.css("top",n.mouseY))}).bind("mousemove",function(t){if(n.curSelectionAction==n.selectionActionEnum.drag){var e=t.pageX-n.mouseX,i=t.pageY-n.mouseY;if(e>0&&i>0&&(n.selectionDirection=n.selectionDirectionEnum.bottomRight),e>0&&i<0){var o=t.pageY-1;n.$multiSelectRect.css("top",o),n.selectionDirection=n.selectionDirectionEnum.topRight}if(e<0&&i<0){var c=t.pageX-1;o=t.pageY-1;n.$multiSelectRect.css("left",c),n.$multiSelectRect.css("top",o),n.selectionDirection=n.selectionDirectionEnum.topLeft}if(e<0&&i>0){c=t.pageX-1;n.$multiSelectRect.css("left",c),n.selectionDirection=n.selectionDirectionEnum.bottomLeft}e=Math.abs(t.pageX-n.mouseX),i=Math.abs(t.pageY-n.mouseY),n.$multiSelectRect.width(e).height(i),n.$multiSelectRect.show()}}).bind("mouseup",function(t){if(n.curSelectionAction==n.selectionActionEnum.drag){var e=0,i=0,o=0,c=0;if(n.selectionDirection==n.selectionDirectionEnum.topLeft)e=t.pageX,i=t.pageY,o=t.pageX+(n.mouseX-t.pageX),c=t.pageY+(n.mouseY-t.pageY);else if(n.selectionDirection==n.selectionDirectionEnum.bottomRight)e=n.mouseX,i=n.mouseY,o=t.pageX,c=t.pageY;else if(n.selectionDirection==n.selectionDirectionEnum.topRight)e=n.mouseX,i=n.mouseY-(n.mouseY-t.pageY),o=n.mouseX+(t.pageX-n.mouseX),c=n.mouseY;else{if(n.selectionDirection!=n.selectionDirectionEnum.bottomLeft)return void n.resetSelection();e=n.mouseX-(n.mouseX-t.pageX),i=n.mouseY,o=n.mouseX,c=n.mouseY+(t.pageY-n.mouseY)}n.getComponentsInSelectionRect(e,i,o,c),n.selectionComponentArr.length>0?(A3Maker.getSelectedComponent()&&A3Maker.getSelectedComponent().setSelectStatus(!1),$.each(n.selectionComponentArr,function(t,e){$(e.componentBorder).removeClass("component_border_common").addClass("component_border_multi_select").show()}),n.curSelectionAction=n.selectionActionEnum.dragSelect,n.mouseX=0,n.mouseY=0,n.$multiSelectRect=$(".multi_select").width(0).height(0).hide()):n.resetSelection()}})},addComponentToSelection:function(t){this.isComponentContained(t)||(this.selectionComponentArr.push(t),t.showBorderSelect(),t.hideGripTool(),this.curSelectionAction=this.selectionActionEnum.ctrlSelect)},removeComponentToSelection:function(t){var e=-1;$.each(this.selectionComponentArr,function(n,i){i.data.UUID!=t.data.UUID||(e=n)}),-1!=e&&(this.selectionComponentArr.splice(e,1),t.hideBorderTool(),t.hideGripTool())},isMultiSelected:function(){return this.curSelectionAction==this.selectionActionEnum.dragSelect||this.curSelectionAction==this.selectionActionEnum.ctrlSelect},isComponentContained:function(t){if(this.selectionComponentArr.length<1)return!1;var e=!1;return $.each(this.selectionComponentArr,function(n,i){i.data.UUID!=t.data.UUID||(e=!0)}),e},getAdjustValueByZoom:function(t){var e=A3Maker.canvas.zoom;if(100==e)return t;var n=0;return n=e<100?parseInt(t/(A3Maker.canvas.zoom/100)):parseInt(100*t/A3Maker.canvas.zoom),n},getMultiSelectedComponentCount:function(){return this.selectionComponentArr.length},getComponentsInSelectionRect:function(t,e,n,i){this.selectionComponentArr.length=0;var o=this,c=A3Maker.getSelectedPage(),a=A3Maker.getSelectedComponent();a&&("listrow"!=a.data.type&&"popup"!=a.data.type&&"list"!=a.data.type||(c=a)),$.each(c.childs,function(c,a){var s=$(a.externalWrapperQueryStr);s.offset().left>=t&&s.offset().top>=e&&s.offset().left+parseInt(s.width())<=n&&s.offset().top+parseInt(s.height())<=i&&o.selectionComponentArr.push(a)})},initializeAlignDialogEventHandler:function(){$(A3Maker.selectionAfterSelectionStr).appendTo("body"),this.$alignActionDialog=$(".align_container"),this.$alignActionDialog.hide(),this.initializeAlignActionEventHandler()},initializeAlignActionEventHandler:function(){var t=this;$(".align_action").click(function(){t.handleAlignAction(this)})},handleAlignAction:function(t){if(!this.isComponentSelected()||this.curSelectionAction!=this.selectionActionEnum.dragSelect&&this.curSelectionAction!=this.selectionActionEnum.ctrlSelect)this.resetSelection();else{var e=$(t).data("action");switch(e){case"left-most":this.alignLeftMost();break;case"top-most":this.alignTopMost();break;case"bottom-most":this.alignBottomMost();break;case"right-most":this.alignRightMost();break;case"align-h-offset":this.alignHorizontalOffset();break;case"align-v-offset":this.alignVerticalOffset();break;case"align-close":break;case"fill":this.fillContainerWithComponent()}this.resetSelection()}},resetSelection:function(){$.each(this.selectionComponentArr,function(t,e){e.hideBorderSelect()}),this.selectionComponentArr.length=0,this.curSelectionAction=this.selectionActionEnum.none,this.mouseX=0,this.mouseY=0,this.$multiSelectRect.width(0).height(0).hide(),this.closeAlignDialog(),this.selectionDirection=0},alignLeftMost:function(){this.selectionComponentArr.sort(function(t,e){return t.data.left-e.data.left});var t="";$.each(this.selectionComponentArr,function(e,n){0==e?t=n:n.setPositionAndWidth(t.data.left,n.data.top,n.data.width,n.data.height)})},alignTopMost:function(){this.selectionComponentArr.sort(function(t,e){return t.data.top-e.data.top});var t="";$.each(this.selectionComponentArr,function(e,n){0==e?t=n:n.setPositionAndWidth(n.data.left,t.data.top,n.data.width,n.data.height)})},alignBottomMost:function(){this.selectionComponentArr.sort(function(t,e){return e.data.top+e.data.height-(t.data.top+t.data.height)});var t="";$.each(this.selectionComponentArr,function(e,n){0==e?t=n:n.setPositionAndWidth(n.date.left,t.data.top+t.data.height-n.data.height,n.data.width,n.data.height)})},alignRightMost:function(){this.selectionComponentArr.sort(function(t,e){return e.data.left+e.data.width-(t.data.left+t.data.width)});var t="";$.each(this.selectionComponentArr,function(e,n){0==e?t=n:n.setPositionAndWidth(t.data.left+t.data.width-n.data.width,n.data.top,n.data.width,n.data.height)})},alignHorizontalOffset:function(){if(!(this.selectionComponentArr.length<3)){this.selectionComponentArr.sort(function(t,e){return t.data.left-e.data.left});var t=this.selectionComponentArr[0],e=this.selectionComponentArr[this.selectionComponentArr.length-1],n=t.data.left+t.data.width/2,i=e.data.left+e.data.width/2,o=parseInt((i-n)/(this.selectionComponentArr.length-1));$.each(this.selectionComponentArr,function(t,e){e.setPositionAndWidth(n+o*t-e.data.width/2,e.data.top,e.data.width,e.data.height)})}},alignVerticalOffset:function(){if(!(this.selectionComponentArr.length<3)){this.selectionComponentArr.sort(function(t,e){return t.data.top-e.data.top});var t=this.selectionComponentArr[0],e=this.selectionComponentArr[this.selectionComponentArr.length-1],n=t.data.top+t.data.height/2,i=e.data.top+e.data.height/2,o=parseInt((i-n)/(this.selectionComponentArr.length-1));$.each(this.selectionComponentArr,function(t,e){e.setPositionAndWidth(e.data.left,n+o*t-e.data.height/2,e.data.width,e.data.height)})}},fillContainerWithComponent:function(){this.selectionComponentArr.length>1?alert("fill action은 단일 컴포넌트만 가능합니다"):$.each(this.selectionComponentArr,function(t,e){var n=e.parent,i=0,o=0,c=n.data.width,a=n.data.height;e.data.fixRatio=!1,e.setPositionAndWidth(i,o,i+c,o+a)})},showAlignDialog:function(t,e){this.$alignActionDialog.css("left",t-10+"px"),this.$alignActionDialog.css("top",e-5+"px"),this.$alignActionDialog.show()},closeAlignDialog:function(){this.$alignActionDialog.hide()}}});