A3Maker=A3Maker||{},$(function(){A3Maker.preview={windowWidth:0,widnowHeight:0,isShowing:!1,$previewContainer:"",$preview:"",$previewWrapper:"",curPageInx:-1,clonePages:[],previewWidth:0,previewHeight:0,prevewProject:"",init:function(){this.windowWidth=$(window).width(),this.windowHeight=$(window).height(),this.curPageInx=-1},initializeCloseEventHandler:function(){var e=this;$(".preClose").click(function(){$("#statusbarArea").show(),e.clonePages.length=0,e.clonePagesLength=0,e.$preview.empty(),e.curPageInx=-1,e.$previewContainer.hide(),e.$previewContainer.remove(),e.isShowing=!1,A3Maker.newPageWindow.isShown&&A3Maker.newPageWindow.showTemporary()})},initializeNextPreEventHandler:function(){var e=this;$(".btpre").click(function(){var t=e.curPageInx-1;t<0||e.showPage(t,"right")}),$(".btnex").click(function(){var t=e.curPageInx+1;t!=e.clonePages.length&&e.showPage(t,"left")})},initializeWindowSizeChangeEventHandler:function(){var e=this;$(window).resize(function(t){e.isShowing&&(e.adjustPreviewPosition(),e.adjustPreviewSize())})},findPreviewZoomOnWindowSize:function(){$(window).innerWidth();for(var e=$(window).innerHeight(),t=0,i=200,n=100;n>10;n-=5)if(this.previewHeight*(n/100)+i<e){t=n;break}return t},adjustPreviewPosition:function(){parseInt(this.previewWidth/2),parseInt(this.previewHeight/2);var e=$(window).innerWidth(),t=$(window).innerHeight(),i=parseInt(e/2);parseInt(t/2);this.$previewWrapper.css("left",i-this.previewWidth/2+"px"),this.$previewWrapper.css("top","50px"),this.$previewWrapper.css("width",this.previewWidth+"px"),this.$previewWrapper.css("height",this.previewHeight+50+"px"),this.$preview.css("width",this.previewWidth+"px"),this.$preview.css("height",this.previewHeight+"px")},adjustPreviewSize:function(){var e=this.findPreviewZoomOnWindowSize()/100,t="50% 0%";this.$previewWrapper.css({"-moz-transform-origin":t,"transform-origin":t,"-ms-transform-origin":t,"-webkit-transform-origin":t}),this.$previewWrapper.css({transform:"scale("+e+","+e+" )"})},showPage:function(e,t){var i=e+1+" of "+this.clonePages.length;if($(".prePage").html(i),-1==this.curPageInx)return $(this.clonePages[e]).show(),void(this.curPageInx=e);-1!=this.curPageInx&&("left"==t&&($(this.clonePages[this.curPageInx]).animate({left:"-"+this.$preview.width()+"px"},200),$(this.clonePages[e]).show(),$(this.clonePages[e]).css("left",parseInt(this.$preview.width())+"px"),$(this.clonePages[e]).css("top","0px"),$(this.clonePages[e]).animate({left:"0px"},200),this.curPageInx=e),"right"==t&&($(this.clonePages[this.curPageInx]).animate({left:this.$preview.width()+"px"},200),$(this.clonePages[e]).show(),$(this.clonePages[e]).css("left","-"+parseInt(this.$preview.width())+"px"),$(this.clonePages[e]).css("top","0px"),$(this.clonePages[e]).animate({left:"0px"},200),this.curPageInx=e))},startPreview:function(){1!=this.isShowing&&($(".editor-page").length<1?alert("현재 페이지가 존재하지 않아 Preview 를 할 수 없습니다"):(this.previewWidth=A3Maker.project.width,this.previewHeight=A3Maker.project.height,this.$previewContainer=$(A3Maker.previewWindowHTML),this.$previewContainer.prependTo($("body")),this.$preview=this.$previewContainer.find(".preview_content"),this.$previewWrapper=this.$previewContainer.find(".preWrap"),this.initializeNextPreEventHandler(),this.initializeCloseEventHandler(),this.initializeWindowSizeChangeEventHandler(),this.clonePages=$(".editor-page").clone(),this.clonePagesLength=this.clonePages.length,this.$preview.append(this.clonePages),this.initCloneDom(),this.addKeyEventHandler(),this.adjustPreviewPosition(),this.adjustPreviewSize(),this.$previewContainer.fadeIn(120),this.setFullScreen(),this.showPage(0,"left"),this.isShowing=!0))},setFullScreen:function(e){var t=document.querySelector("#preBg");this.openFullscreen(t)},openFullscreen:function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},setFullScreen2:function(e){var t=$("#preBg")[0];screenfull.enabled&&screenfull.request(t)},callExternalPreview:function(e,t){if(e&&t){console.log("### 로트할 템플릿 정보"),console.log(e+" :"+t);var i=this;A3Maker.api.A3MakerApi("loadTemplate",{member_seq:e,project_seq:t},function(e){0==e.resultCode&&e.searchResult&&""!=e.searchResult?(console.log("#### [callExternalPreview] 프로젝트 원본 정보 (json)"),console.log(e),i.startPreviewFromJsonObject(e.searchResult)):alert("There is no project")})}else alert("Error occured in calling a function preview : wroing parameter")},startPreviewFromJsonObject:function(e){this.previewProject=e,this.previewWidth=e.width_size,this.previewHeight=e.height_size,this.$previewContainer=$(A3Maker.previewWindowHTML),this.$previewContainer.prependTo($("body")),this.$preview=this.$previewContainer.find(".preview_content"),this.$previewWrapper=this.$previewContainer.find(".preWrap"),A3Maker.newPageWindow&&A3Maker.newPageWindow.isShown&&A3Maker.newPageWindow.hideTemporary(),this.initializeNextPreEventHandler(),this.initializeCloseEventHandler(),this.initializeWindowSizeChangeEventHandler(),this.createProjectDomStructure(e),this.clonePagesLength=this.clonePages.length,this.$preview.append(this.clonePages),this.addKeyEventHandler(),this.adjustPreviewPosition(),this.adjustPreviewSize(),this.$previewContainer.show(),this.showPage(0,"left"),this.isShowing=!0},createProjectDomStructure:function(e){console.log("선택 템플릿 : "+e.prj_name);var t=this;console.log("## 변환되기 전의 프로젝트 정보"),console.log(JSON.parse(e.menu_json));var i=A3Maker.convertScreenData(JSON.parse(e.menu_json));console.log("## 변환된 후의  프로젝트 정보"),console.log(i),this.header=i.HEADER;i.PAGELIST.id;var n=i.PAGELIST.PAGE,r=[];$.each(n,function(e,i){var n=i.ypos,o=(n=i.xpos,i.width),s=i.height,a=(i.name,i.id),c=$("<div></div>").addClass("editor-page").addClass("page").addClass("page-border").addClass(a).css({left:n+"px",top:n+"px",width:o+"px",height:s+"px",position:"absolute",display:"none"});i.IMAGECOMP&&$.each(i.IMAGECOMP,function(e,i){t.createDomAndAppend(c,i,"image")}),i.LINKBUTTONCOMP&&$.each(i.LINKBUTTONCOMP,function(e,i){t.createDomAndAppend(c,i,"link")}),i.ORDERBUTTONCOMP&&$.each(i.ORDERBUTTONCOMP,function(e,i){t.createDomAndAppend(c,i,"order")}),i.LISTCOMP&&t.createListComponent(c,i.LISTCOMP,"list"),i.TEXTCOMP&&$.each(i.TEXTCOMP,function(e,i){t.createDomAndAppend(c,i,"text")}),r.push(c)}),this.clonePages=r},createListComponent:function(e,t){var i=this;t&&t.length>0&&$.each(t,function(t,n){var r=i.createDomAndAppend(e,n,"list");n.LISTROW&&n.LISTROW.length>0&&$.each(n.LISTROW,function(e,t){var n=i.createDomAndAppend(r,t,"listrow");t.IMAGECOMP&&$.each(t.IMAGECOMP,function(e,t){i.createDomAndAppend(n,t,"image")}),t.LINKBUTTONCOMP&&$.each(t.LINKBUTTONCOMP,function(e,t){i.createDomAndAppend(n,t,"link")}),t.ORDERBUTTONCOMP&&$.each(t.ORDERBUTTONCOMP,function(e,t){i.createDomAndAppend(n,t,"order")}),t.TEXTCOMP&&$.each(t.TEXTCOMP,function(e,t){i.createDomAndAppend(n,t,"text")})})})},createPopupComponent:function(e,t){var i=this;(t||t.length>0)&&$.each(t,function(t,n){var r=i.createDomAndAppend(e,n,"popup");n.IMAGECOMP&&$.each(n.IMAGECOMP,function(e,t){i.createDomAndAppend(r,t,"image")}),n.LINKBUTTONCOMP&&$.each(n.LINKBUTTONCOMP,function(e,t){i.createDomAndAppend(r,t,"link")}),n.ORDERBUTTONCOMP&&$.each(n.ORDERBUTTONCOMP,function(e,t){i.createDomAndAppend(r,t,"order")}),n.LISTCOMP&&i.createListComponent(r,n.LISTCOMP,"list"),n.TEXTCOMP&&$.each(n.TEXTCOMP,function(e,t){i.createDomAndAppend(r,t,"text")})})},createDomAndAppend:function(e,t,i){if("image"==i){var n=$("<img/>");return n.addClass("component").addClass("component-image").data("component","image").attr("src",A3Maker.resource.getImageResourcePathByBasePath(this.header.base_path,t.src,"image")),n.css({left:t.xpos+"px",top:t.ypos+"px",width:t.width+"px",height:t.height+"px",position:"absolute"}),e.append(n),""!=n.attr("src")&&"undefined"!=n.attr("src")&&"none"!=n.attr("src")&&n.attr("src")!=A3Maker.resource.getDefaultResourcePath("image")||n.css("opacity",0),n}if("order"==i){var r=$("<img/>");return r.addClass("component").addClass("component-order").data("component","order").attr("src",A3Maker.resource.getImageResourcePathByBasePath(this.header.base_path,t.src,"order")),r.css({left:t.xpos+"px",top:t.ypos+"px",width:t.width+"px",height:t.height+"px",position:"absolute"}),r.attr("item_name",t.menuName),r.attr("item_price",t.menuPrice),r.attr("item_code",t.menuCode),r.attr("store_code",A3Maker.dummy.storeCode),e.append(r),""!=r.attr("src")&&"undefined"!=r.attr("src")&&"none"!=r.attr("src")&&r.attr("src")!=A3Maker.resource.getDefaultResourcePath("order")||r.css("opacity",0),r}if("link"==i){if("YouTube"==t.linktype){var o=$('<iframe frameborder="0" allowfullscreen></iframe>');return o.addClass("component").addClass("component-link").data("component","link"),o.css({left:t.xpos+"px",top:t.ypos+"px",width:t.width+"px",height:t.height+"px",position:"absolute"}),!o.attr("linktype",this.isNullOrUndefined(t.linktype))&&t.linktype,o.attr("position",t.target),o.attr("src",A3Maker.resource.createYoutubeLInk(t.target)),e.append(o),o}var s=$("<img/>");return s.addClass("component").addClass("component-link").data("component","link").attr("src",A3Maker.resource.getImageResourcePathByBasePath(this.header.base_path,t.src,"link")),s.css({left:t.xpos+"px",top:t.ypos+"px",width:t.width+"px",height:t.height+"px",position:"absolute"}),!s.attr("linktype",this.isNullOrUndefined(t.linktype))&&t.linktype,s.attr("position",t.target),e.append(s),""!=s.attr("src")&&"undefined"!=s.attr("src")&&"none"!=s.attr("src")&&s.attr("src")!=A3Maker.resource.getDefaultResourcePath("link")||s.css("opacity",0),s}if("text"==i){var a=$("<div></div>");return a.addClass("component").addClass("component-text").addClass("component-text-area").data("component","text"),a.css({"background-color":"rgba(255,255,255,0)",border:"0",left:t.xpos+"px",top:t.ypos+"px",width:t.width+"px",height:t.height+"px",position:"absolute","font-size":t.font_size,color:t.color,"font-family":t.font_family}),a.html(decodeURIComponent(t.content_text)),e.append(a),a}if("list"==i){var c=$("<div></div>");return c.addClass("component").addClass("component-list").data("component","list"),c.css({left:t.xpos+"px",top:t.ypos+"px",width:t.width+"px",height:t.height+"px",position:"absolute","overflow-y":"auto","overflow-x":"hidden"}),e.append(c),c}if("listrow"==i){var p=$("<div></div>");return p.addClass("component").addClass("component-listrow").data("component","listrow"),p.css({left:t.xpos+"px",top:t.ypos+"px",width:e.width(),height:t.height+"px",position:"absolute"}),e.append(p),p}if("popup"==i){var h=$("<div></div>");return h.addClass("component").addClass("component-popup").data("component","popup"),h.css({left:t.xpos+"px",top:t.ypos+"px",width:t.width+"px",height:t.height+"px",position:"absolute"}),e.append(h),h}},isNullOrUndefined:function(e){return!e||""==e||"undefined"==e},initCloneDom:function(){var e=this;$(".preview_content").find(".cross_grid_line").remove(),$(".preview_content .page-border").removeClass("page-border"),$(".preview_content").find(".grip").remove(),$(".preview_content").find(".component_border").remove(),$(".preview_content").find("*").css("cursor","default"),$(".preview_content").find(".align_component_line").remove(),$(".preview_content .editor-page").css({position:"absolute",cursor:"default"}),$(".preview_content .editor-page").hide(),$(".preview_content .editor-page").removeClass("cross_grid_line"),$(".preview_content .component_border").remove(),$(".preview_content .component").css({cursor:"default"}),$(".preview_content .gray_panel").remove(),$(".preview_content .component-list").css({"background-color":"#FFFFFF"}),$(".preview_content .component-popup").append($('<i style ="color : #34a7c1" class ="fa fa-close fa-2x"></i>').css({position:"absolute",top:"5px",right:"5px",cursor:"pointer"}).bind("click",function(e){$(this).parent().parent().parent().fadeOut(100)})),$(".preview_content .component-popup").css({border:"1px solid #bbbbbb",cursor:"default"}),$(".preview_content .component-list").css({"background-color":"rgba(255,255,255,0)",overflow:"auto"}),$(".preview_content .component-listrow").css({"background-color":"rgb(255,255,255,0)"}),$(".preview_content .component-link").each(function(e){var t=$(this).attr("linktype"),i=$(this).attr("position");if("YouTube"==t){var n=$('<iframe frameborder="0" allowfullscreen></iframe>');n.width($(this).parent().width()),n.height($(this).parent().height()),n.attr("src",A3Maker.resource.createYoutubeLInk(i)),$(this).replaceWith(n)}else""!=$(this).attr("src")&&"undefined"!=$(this).attr("src")&&"none"!=$(this).attr("src")&&$(this).attr("src")!=A3Maker.resource.getDefaultResourcePath("link")||($(this).css("opacity",0),$(this).addClass("component").addClass("component-link").data("component","link"))}),$(".preview_content .component-order").css("cursor","pointer").bind("click",function(t){t.preventDefault(),t.stopPropagation(),e.handleOrder(this)}),$(".preview_content .component-link").css("cursor","pointer").bind("click",function(t){var i=$(this).attr("linktype");$(this).attr("position");"YouTube"!=i&&e.handleLink(this)}),$(".preview_content .component-image").each(function(e){""!=$(this).attr("src")&&"undefined"!=$(this).attr("src")&&"none"!=$(this).attr("src")&&$(this).attr("src")!=A3Maker.resource.getDefaultResourcePath("image")||$(this).css("opacity",0)}),$(".preview_content .component-order").each(function(e){""!=$(this).attr("src")&&"undefined"!=$(this).attr("src")&&"none"!=$(this).attr("src")&&$(this).attr("src")!=A3Maker.resource.getDefaultResourcePath("order")||$(this).css("opacity",0)}),$(".preview_content .component-text").each(function(e){""==$(this).text()&&$(this).attr("placeholder","")})},handleLink:function(e){var t=$(e).attr("linktype"),i=$(e).attr("position");if(i&&""!=i)switch(t){case"PageLink":var n=-1;$(".preview_content .editor-page").each(function(e){$(this).attr("id")!=i||(n=e)}),this.showPage(n,"right");break;case"Web":alert("Open the the specified web ["+i+"]");break;case"Popup":$("#"+i).fadeIn(100);break;case"Phonenumber":alert("calling "+i);break;case"Email":alert("send a E-mail to  "+i);break;case"Map":alert("Map   "+i);break;case"MallInMall":alert("redirect to a mall of  "+i)}else alert("the position of the link component not defined!!")},handleOrder:function(e){var t=$(e).attr("item_name"),i=$(e).attr("item_price"),n=$(e).attr("item_code"),r=$(e).attr("store_code");alert(`주문 전송 ( 가맹점 코드 : ${r} , 상품코드 : ${n},  상품 이름 : ${t}, 상품 가격 : ${i} )`)},addKeyEventHandler:function(){var e=this;this.$previewContainer.keydown(function(t){if(27==t.keyCode&&e.close(),37==t.keyCode){var i=e.curPageInx-1;if(i<0)return;e.showPage(i)}if(39==t.keyCode){i=e.curPageInx+1;if(i==e.clonePages.length)return;e.showPage(i)}})},close:function(){this.clonePages.length=0,this.clonePagesLength=0,this.$preview.empty(),this.curPageInx=-1,this.$previewContainer.fadeOut(120),this.$previewContainer.remove(),this.isShowing=!1,this.previewWidth=0,this.previewHeight=0,this.prevewProject=null}},A3Maker.preview.init()});