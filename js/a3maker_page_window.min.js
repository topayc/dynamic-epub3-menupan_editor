A3Maker=A3Maker||{},$(function(){A3Maker.newPageWindow={$newPageContainer:"",totalTemplateCnt:0,curPage:0,curCategorySeq:0,rowPage:8,totalPageCnt:-1,init:function(){$.ajaxSetup({cache:!1})},isShown:!1,initializeNewPageEventHandler:function(){var e=this;this.$newPageContainer.find(".btn-close-page,.newpage_btn_close").click(function(t){e.close()}),this.$newPageContainer.find(".newpage_btn_preview").hide(),this.$newPageContainer.find(".empty_page").click(function(t){var a,n=A3Maker.getSelectedPage();a=n?A3Maker.project.createPageInsert("after",n):A3Maker.project.createPage(),A3Maker.changeAllComponentSelectStatus(!1),A3Maker.showPage(a);var r=A3Maker.controller.$tree.tree("getNodeById",a.data.UUID);A3Maker.controller.$tree.tree("selectNode",r),A3Maker.controller.applyToolButtonChange(a);for(var i=0,o=0;o<A3Maker.project.pages.length;o++)if(a.data.UUID===A3Maker.project.pages[o].data.UUID){i=o;break}A3Maker.statusBar.setPageSlider({value:i+1}),A3Maker.statusBar.setPageNumberText(i+1,A3Maker.project.pages.length,a.data.name),A3Maker.sidebar.sidebarType===A3Maker.sidebar.sidebarTypeEnums.THUMBNAIL_VIEW&&A3Maker.sidebar.selectBar(A3Maker.sidebar.sidebarTypeEnums.THUMBNAIL_VIEW),e.close()}),this.$newPageContainer.find(".newpage_btn_insert").click(function(t){var a=$(".newpage_right .template li.template_selected");if(0!=a.length){var n=a.attr("project_name"),r=a.attr("project_seq"),i=a.attr("member_seq");n&&i&&r?A3Maker.api.A3MakerApi("loadTemplate",{project_seq:r,member_seq:i},function(t){t&&t.searchResult&&""!=t.searchResult&&0==t.resultCode&&"undefined"!=t.searchResult?(console.log(t),A3Maker.addPageTmeplateToProject(t),e.close()):alert("[project request] wrong reqeust :  ["+t.resultMsg+"]")}):alert("wrong request : 프로젝트 정보가 잘못되었습니다")}else alert("템플릿을 선택해주세요")}),$(document).on("click",".newpage_right .template li",function(e){$(".newpage_right .template li").removeClass("template_selected"),$(".newpage_right .template li i").hide(),$(this).addClass("template_selected"),$(this).find("i").show()})},show:function(){this.$newPageContainer=$(A3Maker.newPageWindowHTML),$("body").prepend(this.$newPageContainer),this.initializeNewPageEventHandler(),this.$newPageContainer.show(),this.$newPageContainer.find(".newpage_left ul").remove(),this.isShown=!0},loadTemplates:function(e,t,a){var n=this,r={category_code_seq:e,curr_page:t,curr_row:t,row_page:a};console.log("[loadTemplates] "+e+" : "+t+" : "+a),A3Maker.api.A3MakerApi("loadTemplates",r,function(r){var i=r.searchResult;n.totalTemplateCnt=i.total_count,n.generateProjectTemplateList(i),n.generatePaging(e,i.total_count,t,a)})},generateProjectTemplateList:function(e){var t=this,a=$(".newpage_right .template");a.empty();e.list.length;var n={tWidth:100,tHeight:141};$.each(e.list,function(e,r){var i=A3Maker.convertScreenData(JSON.parse(r.menu_json)),o=$('<li style ="border : 1px solid #eee" class="template'+e+'"><div class="text_bg">'+r.prj_name+'<div class="sm_preview">Preview</div> </div><i class="template_check fa fa-check-square-o fa-2x"></i></li>');o.css("overflow","hidden"),i.PAGELIST&&i.PAGELIST.PAGE&&i.PAGELIST.PAGE.length&&i.PAGELIST.PAGE.length>0?(n.sWidth=r.width_size,n.sHeight=r.height_size,o.prepend(t.genenrateThumbPageTemplate(i.PAGELIST.PAGE[0],i.HEADER,n)),o.attr("project_seq",r.project_seq),o.attr("member_seq",r.member_seq),o.attr("project_name",r.prj_name),o.appendTo(a),o.find(".text_bg").hide(),o.bind("mouseover",function(e){$(this).find(".text_bg").show()}),o.bind("mouseout",function(e){$(this).find(".text_bg").hide()}),o.find(".sm_preview").click(function(e){e.stopPropagation(),A3Maker.preview.callExternalPreview(r.member_seq,r.project_seq)})):console.log("## wrong page info")})},generatePaging:function(e,t,a,n){if($("ul.page-set").empty(),!(t<=n)){var r=this,i=t%n==0?t/n:t/n+1;$("ul.page-set").append($('<li class="page"><span class="paging_pre_arrow"></span></li>'));for(var o=1;o<=i;o++){var s=$('<li class="page"><a href="javascript:void(0)">'+o+"</a></li>").attr({pageIndex:o-1,category_code_seq:e});$("ul.page-set").append(s),a==o-1&&s.addClass("selected"),s.click(function(e){r.loadTemplates(parseInt($(this).attr("category_code_seq")),parseInt($(this).attr("pageIndex")),r.rowPage)})}$("ul.page-set").append($('<li class="page"><span class="paging_next_arrow"></span></li>'))}},genenrateThumbPageTemplate:function(e,t,a){var n=this,r=$('<div style ="border : 0px"></div>').css({left:"0px",top:"0px",width:a.tWidth+"px",height:a.tHeight+"px",position:"absolute"});return e.IMAGECOMP&&$.each(e.IMAGECOMP,function(e,i){n.createDom(r,i,"image",t,a)}),e.LINKBUTTONCOMP&&$.each(e.IMAGECOMP,function(e,i){n.createDom(r,i,"link",t,a)}),e.TEXTCOMP&&$.each(e.TEXTCOMP,function(e,i){n.createDom(r,i,"text",t,a)}),e.ORDERBUTTONCOMP&&$.each(e.ORDERBUTTONCOMP,function(e,i){n.createDom(r,i,"order",t,a)}),e.LISTCOMP&&n.createListComponent(r,e.LISTCOMP,t,a),e.POPUPPAGE&&n.createPopComponent(r,e.POPUPPAGE,t,a),r},getComponentCss:function(e,t,a){var n={left:this.convertValueBySize(a.tWidth,a.sWidth,e.xpos)+"px",top:this.convertValueBySize(a.tHeight,a.sHeight,e.ypos)+"px",width:this.convertValueBySize(a.tWidth,a.sWidth,e.width)+"px",height:this.convertValueBySize(a.tHeight,a.sHeight,e.height)+"px",position:"absolute"};return"text"==t&&(n.color=e.color,n["font-family"]=e.font_family,n["font-size"]=e.font_size),"list"==t&&(n["backgorund-color"]="rgba(255,255,255,0)"),n},createPopComponent:function(e,t,a,n){var r=this;(t||t.length>0)&&$.each(t,function(t,i){var o=r.createDom(e,i,"popup",a,n);i.IMAGECOMP&&$.each(i.IMAGECOMP,function(e,t){r.createDom(o,t,"image",a,n)}),i.LINKBUTTONCOMP&&$.each(i.IMAGECOMP,function(e,t){r.createDom(o,t,"link",a,n)}),i.TEXTCOMP&&$.each(i.TEXTCOMP,function(e,t){r.createDom(o,t,"text",a,n)}),i.ORDERBUTTONCOMP&&$.each(i.ORDERBUTTONCOMP,function(e,t){r.createDom(o,t,"order",a,n)}),i.LISTCOMP&&r.createListComponent($popup,i.LISTCOMP,a,n)})},createListComponent:function(e,t,a,n){var r=this;t&&t.length>0&&$.each(t,function(t,i){var o=r.createDom(e,i,"list",a,n);i.LISTROW&&i.LISTROW.length>0&&$.each(i.LISTROW,function(e,t){var i=r.createDom(o,t,"listrow",a,n);t.IMAGECOMP&&$.each(t.IMAGECOMP,function(e,t){r.createDom(i,t,"image",a,n)}),t.LINKBUTTONCOMP&&$.each(t.IMAGECOMP,function(e,t){r.createDom(i,t,"link",a,n)}),t.TEXTCOMP&&$.each(t.TEXTCOMP,function(e,t){r.createDom(i,t,"text",a,n)}),t.ORDERBUTTONCOMP&&$.each(t.ORDERBUTTONCOMP,function(e,t){r.createDom(i,t,"order",a,n)})})})},createDom:function(e,t,a,n,r){return"image"==a?($img=$('<img style ="border:0px"/>').attr("src",A3Maker.resource.getImageResourcePathByBasePath(n.base_path,t.src,"image")),$img.css(this.getComponentCss(t,a,r)),e.append($img),$img):"order"==a?($order=$('<img style ="border:0px"/>').attr("src",A3Maker.resource.getImageResourcePathByBasePath(n.base_path,t.src,"order")),$order.css(this.getComponentCss(t,a,r)),e.append($order),$order):"link"==a?($link=$('<img style ="border:0px"/>').attr("src",A3Maker.resource.getImageResourcePathByBasePath(n.base_path,t.src,"link")),$link.css(this.getComponentCss(t,a,r)),e.append($link),$link):"text"==a?($text=$("<textarea></textarea>"),$text.css(this.getComponentCss(t,a,r)),$text.html(t.content_text?t.content_text:""),e.append($text),$text):"list"==a?($list=$("<div></div>").css(this.getComponentCss(t,a,r)),e.append($list),$list):"listrow"==a?($listrow=$("<div></div>").css(this.getComponentCss(t,a,r)),e.append($listrow),$listrow):"popup"==a?($popup=$("<div></div>").css(this.getComponentCss(t,a,r)),e.append($popup),$popup):void 0},convertValueBySize:function(e,t,a){return parseInt(a*e/t)},close:function(){this.$newPageContainer.hide(),this.$newPageContainer.remove(),this.$newPageContainer=null,this.totalTemplateCnt=0,this.curTemplatePage=0,this.curCategorySeq=-1,this.isShown=!1},hideTemporary:function(){this.$newPageContainer.hide()},showTemporary:function(){this.$newPageContainer.show()}},A3Maker.newPageWindow.init()});